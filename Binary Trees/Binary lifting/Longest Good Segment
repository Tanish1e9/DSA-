https://www.codechef.com/problems/LGSEG

#include <bits/stdc++.h>
using namespace std;
#define int long
void populate(int n, int k, int s, vector<int> &arr, vector<int> &prefix_sum, vector<vector<int>> &table) {
    int sum = 0;
    for(int i=0;i<n;i++){
        sum += arr[i];
        prefix_sum[i] = sum;
    }
    
    for(int i=0;i<n;i++) {
       int left = i>=1 ? prefix_sum[i-1] : 0;
       int low = i;
       int high = n-1;
       while(low<=high) {
           int mid = low + (high - low)/2;
           if(prefix_sum[mid]-left > s) high = mid - 1;
           else low = mid + 1;
       }
       table[0][i] = high;
    }
    
    int pow = 1;
    while((1<<pow) <= k) {
        for(int i=0;i<n;i++){
            int mid = table[pow-1][i];
            if(mid+1<n) table[pow][i] = table[pow-1][mid+1];
        }
        pow++;
    }
}

signed main() {
	// your code goes here
	ios::sync_with_stdio(false);
	cin.tie(nullptr);
	cout.tie(nullptr);
	int t;
	cin >> t;
	while(t--) {
	    int n,k,s;
	    cin >> n >> k >> s;
	    vector<int> arr(n);
	    for(int i=0;i<n;i++) {
	        cin >> arr[i];
	    }
	    vector<int> prefix_sum(n,0);
	    vector<vector<int>> table(17, vector<int>(n, n-1));
	    populate(n, k, s, arr, prefix_sum, table);

        int ans = 0;
	    for(int i=0;i<n;i++) {
	        int start = i;
	        for(int j=16;j>=0;j--) {
	            if(start == n) break;
	            if((1<<j)&k){
	                start = table[j][start]+1;
	            }
	        }
	        ans = max(ans, start-i);
	    }
	    cout << ans << endl;
	}
}
